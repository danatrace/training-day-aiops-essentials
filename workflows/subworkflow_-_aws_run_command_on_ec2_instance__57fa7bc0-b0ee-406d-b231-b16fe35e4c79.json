{"id":"57fa7bc0-b0ee-406d-b231-b16fe35e4c79","title":"subworkflow - aws run command on ec2 instance","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"Subworkflow to run a command running on an ec2 instance\n\nThis subworkflow provides an easy way to trigger\nthe execution of a command on a aws ec2 instance\nwithout needing to know how aws ssm works.\n\nThis subworkflow uses the out of the box AWS-RunShellScript\nSSM document to run scripts on ec2 instances.\nWaits until the command execution has finished and\nchecks if the execution was succesful and fails\nif it wasnt so the parent workflow is able to\nrestart the subworkflow on error.\n\nIn order for this subworkflow to execute successfully the ec2 instance must be a systems manager managed instance:\nhttps://docs.aws.amazon.com/systems-manager/latest/userguide/systems-manager-setting-up-ec2.html\n\nParameters \n\ncommands: (Required) command to run on the ec2 instance\nawsregion: (Required) region in which the ec2 instance to run the command on resides\ninstanceid: (Required) instance id on which the command will run\nexecutionTimeout: (Required) execution timeout of the command\nworkingDirectory: (Required) working directory of the command\ndynatraceawsconnection: (Required) dynatrace aws connection\n\nThis subworkflow Needs subworkflow \"subworkflow - aws wait for send command execution\"\n\nThis subworkflow uses the out of the box AWS SSM document AWS-RunShellScript\nhttps://us-east-1.console.aws.amazon.com/systems-manager/documents/AWS-RunShellScript/description?region=us-east-1","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":false,"triggerType":"Manual","schemaVersion":3,"trigger":{},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:51.891Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:51.891Z"},"result":"{{ result(\"wait-for-result\") }}","type":"STANDARD","input":{"commands":["echo test","sleep 100"],"awsregion":"us-east-1","instanceid":"i-0e831c54dc3f2f0c7","executionTimeout":"3600","workingDirectory":"/home/ubuntu","dynatraceawsconnection":"awsplayground"},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"wait-for-result":{"name":"wait-for-result","input":{"workflowId":"97218693-adf0-4c82-a295-e43d848b0b4d","workflowInput":"{\n  \"CommandId\":\"{{result(\"systems_manager_send_command_1\")[\"Command\"].CommandId }}\",\n  \"awsregion\":\"{{input()[\"awsregion\"] }}\",\n  \"awsinstanceid\":\"{{input()[\"instanceid\"] }}\",\n  \"dynatraceawsconnection\": \"{{ input()[\"dynatraceawsconnection\"] }}\"\n}"},"retry":{"count":5,"delay":120,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-workflow","timeout":604800,"position":{"x":0,"y":2},"conditions":{"states":{"systems_manager_send_command_1":"OK"}},"description":"Modularize your workflows, run any existing workflow.","waitBefore":30,"predecessors":["systems_manager_send_command_1"]},"systems_manager_send_command_1":{"name":"systems_manager_send_command_1","input":{"region":"{{ input()[\"awsregion\"] }}","Parameters":"{\n  \"commands\": {{ input()[\"commands\"] | replace(\"'\",'\"') }}\n}","connection":"{% set awsconnection = input()[\"dynatraceawsconnection\"] %}\n{{ connection('builtin:hyperscaler-authentication.connections.aws', awsconnection) }}","InstanceIds":"{{ input()[\"instanceid\"] }}","DocumentName":"AWS-RunShellScript"},"retry":{"count":5,"delay":60,"failedLoopIterationsOnly":true},"action":"dynatrace.aws.connector:ssm-send-command","active":true,"timeout":604800,"position":{"x":0,"y":1},"description":"Runs commands on one or more managed nodes","predecessors":[]}}}