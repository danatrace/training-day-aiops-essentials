{"id":"03659848-380f-425c-8cc6-7a58ced48f87","title":"template - aws volume remediation","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"Subworkflow example to run a multistep aws volume remediation\n\nThis subworkflow uses multiple subworkflows to remediate\nan aws volume that is running out of diskspace.\n\nAs first step it tries a standard cleanup (deleting typical files that grow large over time\nbut are not needed) then checks if the problem is solved, if its not solved\nit will run the resize of a volume, then reboot the ec2 instance (needed after resize\nfor the ec2 instance to detect the new size of the volume)\nthen checks again if the problem was solved, if not escalates via email.\n\nThe workflow also keeps Service now incidents up to date and ingests events for\nthe remedation steps into dynatrace.","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":false,"triggerType":"Manual","schemaVersion":3,"trigger":{},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:58.623Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:58.623Z"},"result":null,"type":"STANDARD","input":{"osType":"","ebs_name":"","event_id":"dyn.get-aws-system-manager-status","host_name":"i-0922ad0641af731f9","volume_id":"","aws_region":"","display_id":"","instance_id":"","ec2_entity_id":"","host_entity_id":"","escalation_email":"daniel.braaf@dynatrace.com","future_disk_size":"","volume_entity_id":"","current_disk_size":"","dynatraceawsconnection":"awssandbox"},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"resize-volume":{"name":"resize-volume","input":{"workflowId":"5052e41e-caa3-4bc8-a818-5f7b3999dbdb","workflowInput":"{\n  \"osType\": \"{{ input()[\"osType\"] }}\",\n  \"SizeGib\": \"{{input()[\"future_disk_size\"]}}\",\n  \"VolumeId\": \"{{input()[\"volume_id\"] }}\",\n  \"awsregion\": \"{{input()[\"aws_region\"] }}\",\n  \"InstanceId\": \"{{ input()[\"instance_id\"] }}\",\n  \"MountPoint\": \"/\",\n  \"DriveLetter\": \"\",\n  \"keepSnapShot\": \"false\",\n  \"dynatraceawsconnection\":\"{{input()[\"dynatraceawsconnection\"] }}\",\n  \"AutomationAssumeRolearn\": \"\"\n}"},"action":"dynatrace.automations:run-workflow","active":true,"position":{"x":0,"y":3},"conditions":{"custom":"","states":{"check-if-problem-is-solved-1":"ERROR"}},"description":"Modularize your workflows, run any existing workflow.","predecessors":["check-if-problem-is-solved-1"]},"run-standard-cleanup":{"name":"run-standard-cleanup","input":{"workflowId":"57fa7bc0-b0ee-406d-b231-b16fe35e4c79","workflowInput":"{\n\"commands\":[\"sudo rm /home/ubuntu/large_file.log || true\"],\n\"awsregion\":\"{{input()[\"aws_region\"] }}\",\n\"instanceid\":\"{{ input()[\"instance_id\"] }}\",\n\"executionTimeout\":\"3600\",\n\"workingDirectory\":\"/home/ubuntu\",\n\"dynatraceawsconnection\":\"{{input()[\"dynatraceawsconnection\"] }}\"\n}"},"action":"dynatrace.automations:run-workflow","active":true,"position":{"x":0,"y":1},"conditions":{"states":{}},"description":"Modularize your workflows, run any existing workflow.","waitBefore":20,"predecessors":[]},"send-escalation-email":{"name":"send-escalation-email","input":{"cc":[],"to":["{{ input()[\"escalation_email\"] }}"],"bcc":[],"taskId":"{{ task().id }}","content":"Auto Remediation was not Successful\nDynatrace Remediation Workflow: {{ environment() }}/ui/apps/dynatrace.automations/executions/{{ execution().id }}\nProblem id: [code]<a href=\"{{environment().url }}/ui/apps/dynatrace.classic.problems/problems/problemdetails;gtf=-6h;gf=all;pid={{input()[\"event_id\"]}}\" target=\"_blank\">{{input()[\"event_id\"]}} </a>[/code]\nProblem id link: [code]<a href=\"{{environment().url }}/ui/apps/dynatrace.davis.problems/problem/{{input()[\"event_id\"]}}\" target=\"_blank\">{{input()[\"event_id\"]}} </a>[/code]","subject":"Auto Remediation was not Successful","executionId":"{{ execution().id }}","environmentUrl":"{{ environment().url }}"},"action":"dynatrace.email:send-email","active":true,"position":{"x":0,"y":5},"conditions":{"custom":"{{ result(\"check-for-recent-remediation\").restartinstance == true }}","states":{"check-if-problem-is-solved-2":"ERROR"}},"description":"Send email","predecessors":["check-if-problem-is-solved-2"]},"check-if-problem-is-solved-1":{"name":"check-if-problem-is-solved-1","input":{"workflowId":"d31cdf5e-f1ca-4583-a850-67af54e3dde7","workflowInput":"{\"dynatrace_problem_display_id\": \"{{input()[\"display_id\"] }}\"}"},"retry":{"count":2,"delay":120,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-workflow","active":true,"position":{"x":0,"y":2},"conditions":{"custom":"","states":{"run-standard-cleanup":"ANY"}},"description":"Modularize your workflows, run any existing workflow.","waitBefore":500,"predecessors":["run-standard-cleanup"]},"check-if-problem-is-solved-2":{"name":"check-if-problem-is-solved-2","input":{"workflowId":"d31cdf5e-f1ca-4583-a850-67af54e3dde7","workflowInput":"{\"dynatrace_problem_display_id\": \"{{input()[\"display_id\"] }}\"}"},"retry":{"count":10,"delay":60,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-workflow","active":true,"timeout":90000,"position":{"x":0,"y":4},"conditions":{"custom":"","states":{"resize-volume":"OK"}},"description":"Modularize your workflows, run any existing workflow.","waitBefore":500,"predecessors":["resize-volume"]},"ingest-remediation-event-resize-volume":{"name":"ingest-remediation-event-resize-volume","input":{"workflowId":"74a063e4-576a-4955-b477-1c531bcf7ad1","workflowInput":"{\n\"title\":\"Remediation - ({{ input()[\"display_id\"] }} Low Storage Warning {{ input()[\"ebs_name\"] }}) Start resize disk volume {{input()[\"volume_id\"] }} from {{ input()[\"current_disk_size\"] }} gb to {{ input()[\"future_disk_size\"] }} gb on host {{input()[\"host_name\"] }}\",\n\"properties\":{\n\"workflow\":\"{{ environment().url }}/ui/apps/dynatrace.automations/executions/{{ execution().id }}\",\n\"remediation_step\":\"resize disk volume\",\n\"remediation_host_name\":\"{{input()[\"host_name\"] }}\",\n\"remediation_entity_name\":\"{{input()[\"volume_id\"]}}\"}\n}"},"retry":{"count":5,"delay":30,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-workflow","active":true,"position":{"x":-1,"y":4},"conditions":{"custom":"","states":{"resize-volume":"OK"}},"description":"Modularize your workflows, run any existing workflow.","predecessors":["resize-volume"]},"ingest-remediation-event-run-standard-cleanup":{"name":"ingest-remediation-event-run-standard-cleanup","input":{"workflowId":"74a063e4-576a-4955-b477-1c531bcf7ad1","workflowInput":"{\n\"title\":\"Remediation - ({{ input()[\"display_id\"] }} Low Storage Warning {{ input()[\"ebs_name\"] }}) Start disk cleanup on host {{input()[\"host_name\"] }}\",\n\"properties\":{\n\"workflow\":\"{{ environment().url }}/ui/apps/dynatrace.automations/executions/{{ execution().id }}\",\n\"remediation_step\":\"start disk cleanup\",\n\"remediation_host_name\":\"{{input()[\"host_name\"] }}\",\n\"remediation_entity_name\":\"{{input()[\"volume_id\"]}}\"}\n}"},"retry":{"count":5,"delay":30,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-workflow","active":true,"position":{"x":-1,"y":2},"conditions":{"states":{"run-standard-cleanup":"OK"}},"description":"Modularize your workflows, run any existing workflow.","waitBefore":60,"predecessors":["run-standard-cleanup"]}}}