{"id":"3e5454a4-50ad-4dab-914c-638b6df5b283","title":"subworkflow - aws get host data of ec2 instance","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"Subworkflow to get data of an aws ec2 instance without needing to know dql\n\nAn easy way to get additional data of an aws host\nsuch as instance id, volume id etc. which is needed\nto for example resize an aws volume.\n\nParameters:\n\nhost_entity_id: (Required) Dynatrace Host Entity Id","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":false,"triggerType":"Manual","schemaVersion":3,"trigger":{},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:49.468Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:49.468Z"},"result":"{{ result(\"dql-get-host-info\").records[0] }}","type":"STANDARD","input":{"host_entity_id":"HOST-EA0E775A9C448B02"},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"dql-get-host-info":{"name":"dql-get-host-info","input":{"query":"fetch dt.entity.host\n| filter matchesPhrase(id, \"{{input()[\"host_entity_id\"]}}\")\n| fieldsadd  additionalSystemInfo,belongs_to,ec2_id=runs_on[dt.entity.ec2_instance], entity.name, hostname=entity.detected_name, osArchitecture, osType, cpuCores, autoInjection, bitness, cloudType, clustered_by,  ebpfHasPublicTraffic,  state\n| lookup  [fetch dt.entity.ec2_instance\n| fieldsadd awscredentials=accessible_by[dt.entity.aws_credentials], awsInstanceId,awsInstanceType,awsNameTag, awsSecurityGroup, awsVpcName, arn, tags, id, regionName, accessible_by,amiId,balanced_by,beanstalkEnvironmentName,belongs_to,boshName,contains,publicHostName,publicIp,localIp,virtualizedDiskType,entity.name,lifetime, entity.type  ] , sourceField:ec2_id, lookupField:id, prefix:\"ec2_\"\n| lookup  [smartscapeNodes \"AWS_EC2_INSTANCE\"\n| parse aws.object,\"JSON:object\"\n| fieldsadd object\n| fieldsadd configuration=object[configuration] \n| fieldsadd instanceId=configuration[instanceId]\n| filter matchesPhrase(configuration[state][name],\"running\")\n| fieldsadd blockDeviceMappings=configuration[blockDeviceMappings]\n| expand blockDeviceMappings\n| fieldsadd deviceName=blockDeviceMappings[deviceName], volumeid=blockDeviceMappings[ebs][volumeId], deleteOnTermination=blockDeviceMappings[ebs][deleteOnTermination], aws.account.id ] , sourceField:ec2_awsInstanceId, lookupField:instanceId, prefix:\"ebs_\"\n| fieldsadd volumeid=ebs_volumeid\n| lookup  [ timeseries max(dt.host.disk.used), by: { dt.entity.host, dt.entity.disk }\n| fieldsAdd disksizex = arrayLast(`max(dt.host.disk.used)`)/1000000000\n| fieldsadd disksize=round(disksizex), dt.entity.host, diskid=dt.entity.disk\n] , sourceField:id, lookupField:dt.entity.host, prefix:\"disk_\"\n| fieldsadd ebs_id=disk_diskid\n| lookup  [ timeseries max(dt.host.disk.avail), by: { dt.entity.host }\n| fieldsAdd disksizex = arrayLast(`max(dt.host.disk.avail)`)/1000000000\n| fields disksize=round(disksizex), dt.entity.host\n] , sourceField:id, lookupField:dt.entity.host, prefix:\"disk_avail_\"\n| fieldsadd total_disk_size=disk_disksize + disk_avail_disksize, disk_used=disk_disksize, disk_available=disk_avail_disksize, awsaccountid=ebs_aws.account.id\n| fieldsremove disk_avail_disksize,disk_disksize","failOnEmptyResult":true},"action":"dynatrace.automations:execute-dql-query","active":true,"position":{"x":0,"y":1},"conditions":{"states":{}},"description":"Executes DQL query","predecessors":[]}}}