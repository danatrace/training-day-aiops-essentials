{"id":"c96bdcad-64b6-45a8-a4d1-ed247c4beac0","title":"AWS Security create Alert for public security groups","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":true,"triggerType":"Schedule","schemaVersion":3,"trigger":{"schedule":{"isActive":true,"isFaulty":false,"trigger":{"type":"interval","intervalMinutes":5},"rule":null,"filterParameters":{"earliestStart":"2025-05-29","earliestStartTime":"00:13"},"timezone":"America/Los_Angeles","inputs":{},"nextExecution":"2026-01-15T04:13:00.000Z"}},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:28.492Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:28.492Z"},"result":null,"type":"STANDARD","input":{},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"create-custom-alert":{"name":"create-custom-alert","input":{"workflowId":"9a868582-bf92-4d2c-aea5-90898f7e86b8","workflowInput":"{\n  \"title\": \"AWS Security group {{_.item.groupName }} with id {{_.item.groupId }} allows traffic on {{_.item.cidrIp }} from port {{_.item.fromPort }} to port {{_.item.toPort }}\",\n  \"event.description\": \"AWS Security group {{_.item.groupName }} with id {{_.item.groupId }} allows traffic on {{_.item.cidrIp }} from port {{_.item.fromPort }} to port {{_.item.toPort }}\",\n  \"properties\": {\n    \"dt.smartscape_source.id\": \"{{_.item.id }}\",\n    \"GroupId\": \"{{_.item.groupId}}\",\n    \"GroupName\": \"{{_.item.groupName}}\",\n    \"Description\": \"{{_.item.description}}\",\n    \"SecurityGroupArn\": \"{{_.item.securityGroupArn}}\",\n    \"region\": \"{{_.item[\"aws.region\"]}}\",\n    \"cidrIp\": \"{{_.item.cidrIp }}\",\n    \"fromPort\": \"{{_.item.fromPort}}\",\n    \"toPort\": \"{{_.item.toPort}}\",\n    \"awsaccountid\": \"{{ _.item[\"aws.account.id\"] }}\"\n  }\n}"},"action":"dynatrace.automations:run-workflow","active":true,"timeout":9999,"position":{"x":0,"y":2},"conditions":{"custom":"{{result(\"find-security-groups\")|length > 0  }}","states":{"find-security-groups":"OK"}},"withItems":"item in {{result(\"find-security-groups\").records}}","concurrency":1,"description":"Modularize your workflows, run any existing workflow.","predecessors":["find-security-groups"]},"find-security-groups":{"name":"find-security-groups","input":{"query":"smartscapeNodes \"AWS_EC2_SECURITYGROUP\"\n| parse aws.object,\"JSON:object\"\n| fieldsadd object\n| fieldsadd configuration=object[configuration]\n| fieldsadd ipPermissions=configuration[ipPermissions]\n| expand ipPermissions\n| fieldsadd ipRanges=ipPermissions[ipRanges]\n| expand ipRanges\n| fields aws.account.id,aws.vpc.id, aws.region, id,groupId=configuration[groupId], vpcId=configuration[vpcId], securityGroupArn=configuration[securityGroupArn], ownerId=configuration[ownerId], groupName=configuration[groupName],description=configuration[description], ipProtocol=ipPermissions[ipProtocol], fromPort=ipPermissions[fromPort], toPort=ipPermissions[toPort],cidrIp=ipRanges[cidrIp],tags\n| filter cidrIp == \"0.0.0.0/0\"\n| filter aws.account.id == \"554872066791\" // only for testing remove for go live\n| filter  matchesphrase(groupName,\"performpublicsecuritygroup*\" ) // only for testing remove for go live\n//| limit 1 // only for testing remove for go live"},"action":"dynatrace.automations:execute-dql-query","position":{"x":0,"y":1},"conditions":{"states":{}},"description":"Make use of Dynatrace Grail data in your workflow.","predecessors":[]}}}