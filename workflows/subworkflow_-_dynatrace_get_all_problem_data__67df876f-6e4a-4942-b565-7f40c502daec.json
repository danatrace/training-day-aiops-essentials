{"id":"67df876f-6e4a-4942-b565-7f40c502daec","title":"subworkflow - dynatrace get all problem data","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"Subworkflow to get all data of a Davis Problem.\n\nThe Davis Problem trigger does not contain all necessary information\nfrom a Problem card, for example the Impact field and affected users\nwhich is important to determine the Priority of a Problem, to then\nset a Priority in tracking tools like Jira and Service now. \nThis Sub Workflow makes it easy to get that addtional information\nwithout needing to know Javascript.\n\nThe Subworkflow also contains setting the priority for a Jira\nissue from the Data of the Problem card. This might not\nbe the same for every customer, but easy adjustable in the \nsection \"// calculate jira impact level\" in the get-problem-info\ntask.\n\nParameters:\n\nevent.id: (Required) Dyantrace event id","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":false,"triggerType":"Manual","schemaVersion":3,"trigger":{},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:56.155Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:56.155Z"},"result":"{{ result(\"get-problem-info\") }}","type":"STANDARD","input":{"event.id":"2847618168410183866_1744904520000V2"},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"get-problem-info":{"name":"get-problem-info","input":{"script":"// optional import of sdk modules\nimport { execution } from '@dynatrace-sdk/automation-utils';\nimport { problemsClient } from '@dynatrace-sdk/client-classic-environment-v2';\nimport { getEnvironmentUrl } from \"@dynatrace-sdk/app-environment\";\n\nexport default async function ({ executionId }) {\n  // your code goes here\n  const { input } = await fetch(`/platform/automation/v1/executions/${executionId}`).then((res) => res.json());\n\n  \n  console.log(input)\n  console.log(input.display_id)\n  \n\n  const data = await problemsClient.getProblem({\n    problemId: \"\"+input['event.id']+\"\"\n  });\n  //console.log(data)\n  // Leave comment\n\n\n  // calculate jira impact level\n  let impact = \"Lowest\"; // possible jira impact values Lowest, Low, Medium, High, Highest\n  let affected_users: number = 0;\n\n    // calculate amount of impacted users\n  for (let impacts of data.impactAnalysis.impacts) {\n      \n  affected_users = affected_users + impacts.estimatedAffectedUsers\n  console.log(affected_users);\n    \n    \n  }\n  \n  // if impactLevel equals APPLICATION and severityLevel equals AVAILABILITY and no affected users set priority to high\n  if (data.impactLevel == \"APPLICATION\" && data.severityLevel == \"AVAILABILITY\" && affected_users == 0) {\n  impact = \"High\";    \n  }\n  // if impactLevel equals APPLICATION and severityLevel equals AVAILABILITY and affected users set priority to highest\n  if (data.impactLevel == \"APPLICATION\" && data.severityLevel == \"AVAILABILITY\" &&  affected_users > 0) {\n  impact = \"Highest\";     \n  }\n\n  if (data.impactLevel == \"APPLICATION\" && data.severityLevel == \"RESOURCE_CONTENTION\" &&  affected_users > 0) {\n  impact = \"Highest\";     \n  }\n\n  if (data.impactLevel == \"APPLICATION\" && data.severityLevel == \"RESOURCE_CONTENTION\" && affected_users == 0) {\n  impact = \"High\";     \n  }\n  \n  \n  \n  \n  // with a focus on Business Resilience we always chose the highest priority if end users are affected\n  if (affected_users > 0) {\n  impact = \"Highest\";     \n  }\n\n  // add jira impact to problem details\n  data[\"jira_impact\"] = impact;\n  \n  console.log(\"Problem Impact Level: \"+data.impactLevel);\n  console.log(\"Problem Severity Level: \"+data.severityLevel);\n  console.log(\"Number of affected users: \"+affected_users);\n  console.log(\"Setting Jira Impact to: \"+impact);\n  \n\n  return data;\n}"},"retry":{"count":5,"delay":30,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-javascript","position":{"x":0,"y":1},"conditions":{"states":{}},"description":"Run custom JavaScript code.","predecessors":[]}}}