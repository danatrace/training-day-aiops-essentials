{"id":"f8fdc88c-9a8c-4f3b-8198-9a021996515e","title":"subworkflow - aws disable public access for security group","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"Subworkflow to disable SSH and RDP ports opened to IP address specified, or open  to all addresses (0.0.0.0/0) if no address is specified.\n\nThe security group must have existing rules specifically on the SSH and RDP ports in order for ingress to be disabled.\n\nParameters:\n\nawssecuritygroupid: (Required) aws security group id to close traffic \nipaddresstoblock: (Optional) Additional Ipv4 or Ipv6 address to block access from (ex:1.2.3.4/32) (if not given all ip addresses will be taken into consideration)\nawsregion: (Required) region in which the security group resides\ndynatraceawsconnection: (Required) the connection name of the Dynatrace OIDC Connection\n\nThis subworkflow Needs subworkflow \"subworkflow - aws wait for systems manager document execution\"\nSubworkflow will wait for ssm document execution and will fail if ssm document fails\n\nThis subworkflow uses the out of the box AWS SSM document AWS-DisablePublicAccessForSecurityGroup\nhttps://us-east-1.console.aws.amazon.com/systems-manager/documents/AWS-DisablePublicAccessForSecurityGroup/description?region=us-east-1","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":false,"triggerType":"Manual","schemaVersion":3,"trigger":{},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:47.769Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:47.769Z"},"result":"{{ result(\"wait-for-ssm-execution-completed\") }}","type":"STANDARD","input":{"awsregion":"us-east-1","ipaddresstoblock":"0.0.0.0/0","awssecuritygroupid":"sg-010d8b10c89d61c2c","dynatraceawsconnection":""},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"check-status":{"name":"check-status","input":{"script":"// optional import of sdk modules\nimport { execution } from '@dynatrace-sdk/automation-utils';\n\nexport default async function ({ execution_id }) {\n  const configGet = await fetch(`/platform/automation/v1/executions/${execution_id}/tasks/wait-for-ssm-execution-completed/result`);\n  const configBody = await configGet.json();\n  const status = configBody.AutomationExecutionStatus.toUpperCase()\n  console.log(status)\n  \n  if (status !=\"SUCCESS\") {\n        console.log(\"SSM Document Execution has Failed!\");\n        throw new Error(\"SSM Document Execution has Failed!\");\n  } \n\n  return configBody;\n}"},"action":"dynatrace.automations:run-javascript","position":{"x":0,"y":3},"conditions":{"states":{"wait-for-ssm-execution-completed":"OK"}},"description":"Run custom JavaScript code.","predecessors":["wait-for-ssm-execution-completed"]},"wait-for-ssm-execution-completed":{"name":"wait-for-ssm-execution-completed","input":{"workflowId":"20661ec0-29d5-471f-9973-29679d5fe908","workflowInput":"{\n\"AutomationExecutionId\":\"{{result(\"systems_manager_start_automation_execution_1\").AutomationExecutionId }}\",\n\"awsregion\": \"{{input()[\"awsregion\"] }}\",\n\"dynatraceawsconnection\": \"{{ input()[\"dynatraceawsconnection\"] }}\"\n}"},"retry":{"count":99,"delay":60,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-workflow","timeout":604800,"position":{"x":0,"y":2},"conditions":{"states":{"systems_manager_start_automation_execution_1":"OK"}},"description":"Modularize your workflows, run any existing workflow.","predecessors":["systems_manager_start_automation_execution_1"]},"systems_manager_start_automation_execution_1":{"name":"systems_manager_start_automation_execution_1","input":{"region":"{{ input()[\"awsregion\"]}}","Parameters":"{ \n  \"GroupId\": [\"{{input()[\"awssecuritygroupid\"] }}\"],\n  \"IpAddressToBlock\": [\"{{input()[\"ipaddresstoblock\"] }}\"]\n}","connection":"{% set awsconnection = input()[\"dynatraceawsconnection\"] %}\n{{ connection('builtin:hyperscaler-authentication.connections.aws', awsconnection) }}","DocumentName":"AWS-DisablePublicAccessForSecurityGroup"},"retry":{"count":5,"delay":60,"failedLoopIterationsOnly":true},"action":"dynatrace.aws.connector:ssm-start-automation-execution","active":true,"timeout":604800,"position":{"x":0,"y":1},"description":"Initiates execution of an Automation runbook","predecessors":[]}}}