{"id":"97218693-adf0-4c82-a295-e43d848b0b4d","title":"subworkflow - aws wait for run command execution","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"Subworkflow to wait for aws ssm run command execution to finish\n\nThis subworkflow is used in the \"aws run command on ec2 instance\" subworkflow\nto wait for the execution to finish and check the status of the execution.\nIf the execution wasnt successful the subworklow will fail so that\nparent workflows can respond with rerun on error.\n\nParameters:\n\nawsregion: (Required) Region in which the SSM document runs\nawsinstanceid: (Required) Instance id on which the run command ssm document was executed\nCommandId: (Required) Command id of the run command execution (Returned by Run command actions)\ndynatraceawsconnection: (Required) Dynatrace oidc connection name","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":false,"triggerType":"Manual","schemaVersion":3,"trigger":{},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:52.687Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:52.687Z"},"result":"{{ result(\"get-status\").Commands }}","type":"STANDARD","input":{"CommandId":"2824c2b0-29aa-40b5-8924-c5169c07c2cc","awsregion":"us-east-1","awsinstanceid":"i-0e831c54dc3f2f0c7","dynatraceawsconnection":"awsplayground"},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"get-status":{"name":"get-status","input":{"region":"{{ input()[\"awsregion\"] }}","CommandId":"{{ input()[\"CommandId\"] }}","connection":"{% set awsconnection = input()[\"dynatraceawsconnection\"] %}\n{{ connection('builtin:hyperscaler-authentication.connections.aws', awsconnection) }}"},"action":"dynatrace.aws.connector:ssm-list-commands","active":true,"position":{"x":0,"y":1},"description":"Lists the commands requested by users of the Amazon Web Services account","predecessors":[]},"check-status":{"name":"check-status","input":{"script":"// optional import of sdk modules\nimport { execution } from '@dynatrace-sdk/automation-utils';\nimport { actionExecution } from \"@dynatrace-sdk/automation-utils\";\n\nexport default async function ({ execution_id, action_execution_id }) {\n  const actionEx = await actionExecution(action_execution_id);\n  console.log(actionEx.loopItem.item)\n  const status = actionEx.loopItem.item.Status.toUpperCase()\n  console.log(status)\n  \n  if (status ==\"INPROGRESS\") {\n        console.log(\"Send Command Execution is still running, restarting again!\");\n        throw new Error(\"Send Command Execution is still running, restarting again!\");\n  } \n\n  return status;\n}"},"action":"dynatrace.automations:run-javascript","active":true,"position":{"x":0,"y":2},"conditions":{"states":{"get-status":"OK"}},"withItems":"item in {{ result(\"get-status\").Commands }}","concurrency":1,"description":"Build a custom task running js Code","predecessors":["get-status"]}}}