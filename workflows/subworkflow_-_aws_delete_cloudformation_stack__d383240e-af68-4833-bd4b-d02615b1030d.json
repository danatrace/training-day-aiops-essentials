{"id":"d383240e-af68-4833-bd4b-d02615b1030d","title":"subworkflow - aws delete cloudformation stack","isDeployed":true,"taskDefaults":{},"lastExecution":null,"description":"Subworkflow to Delete an AWS CloudFormation Stack\n\nThis subworkflow provides a simple way to trigger the deletion of an AWS CloudFormation stack \n\nParameters:\n\ncf_stackname: (Required) stackname of the cloudformation stack you want to delete\nawsregion: (Required) region in which you want to delete the cloudformation stack\ndynatraceawsconnection: (Required) Dynatrace aws oidc connection name\n\nThis subworkflow needs the custom SSM Document \n\"Dynwf-DeleteCloudFormationStack\" available in the\nregion that is handed over by the parameter \"awsregion\" \n\nThe subworkflow sends the command to delete a cloudformation stack to the\naws SSM document \"Dynwf-DeleteCloudFormationStack\", then waits until\nthe SSM document has finished and then checks if the deletion was \nsuccessful. If not, it will fail the subworkflow to provide a \nrestart on error functionality to the Parent workflow\n\nSteps to Import AWS SSM Document/Runbook Yaml:\n***********************************************\n1.) Open the Following link https://us-east-1.console.aws.amazon.com/systems-manager/documents/create-document?region=us-east-1#documentType=Automation\n    That will take you to the AWS Management Console (you need to be loggin it) and open the Runbook builder to create a new Runbook\n\n2.) If needed change the aws region of the Runbook in the console\n3.) In the upper left corner Change the Runbook name into \"Dynwf-DeleteCloudFormationStack\"\n4.) Click on the {} Code button next to the runbook name this will take you to the yaml def. of the runbook\n5.) Paste the Yaml content below into the code field\n\n# yaml file start\n\nschemaVersion: '0.3'\ndescription: |-\n  *Replace this default text with instructions or other information about your runbook.*\n\n  ---\n  # What is Markdown?\n  Markdown is a lightweight markup language that converts your content with plain text formatting to structurally valid rich text.\n  ## You can add headings\n  You can add *italics* or make the font **bold**.\n  1. Create numbered lists\n  * Add bullet points\n  >Indent `code samples`\n\n  You can create a [link to another webpage](https://aws.amazon.com).\nparameters:\n  stackname:\n    type: String\nmainSteps:\n  - name: DeleteCloudFormationStack\n    action: aws:deleteStack\n    isEnd: true\n    inputs:\n      StackName: '{{ stackname }}'\n# yaml file end\n      \n6.) Click on create runbook\n\nThis Subworkflow uses and needs the subworkflow \"subworkflow - aws wait for systems manager  document execution\"","actor":"bc935a57-c7d3-440e-922c-79a22bf7afd6","owner":"bc935a57-c7d3-440e-922c-79a22bf7afd6","ownerType":"USER","isPrivate":false,"triggerType":"Manual","schemaVersion":3,"trigger":{},"modificationInfo":{"createdBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","createdTime":"2026-01-15T04:09:46.774Z","lastModifiedBy":"bc935a57-c7d3-440e-922c-79a22bf7afd6","lastModifiedTime":"2026-01-15T04:09:46.774Z"},"result":"{{ result(\"wait-for-ssm-execution-completed\") }}","type":"STANDARD","input":{"awsregion":"us-east-1","cf_stackname":"serverless-demo","dynatraceawsconnection":"awsplayground"},"hourlyExecutionLimit":1000,"throttle":{"isLimitHit":false,"limitEvents":[]},"workflowLimit":{"isActive":false},"version":1,"unacknowledgedSkippedScheduleAt":null,"tasks":{"check-status":{"name":"check-status","input":{"script":"// optional import of sdk modules\nimport { execution } from '@dynatrace-sdk/automation-utils';\n\nexport default async function ({ execution_id }) {\n  const configGet = await fetch(`/platform/automation/v1/executions/${execution_id}/tasks/wait-for-ssm-execution-completed/result`);\n  const configBody = await configGet.json();\n  const status = configBody.AutomationExecutionStatus.toUpperCase()\n  console.log(status)\n  \n  if (status !=\"SUCCESS\") {\n        console.log(\"SSM Document Execution has Failed!\");\n        throw new Error(\"SSM Document Execution has Failed!\");\n  } \n\n  return configBody;\n}"},"action":"dynatrace.automations:run-javascript","position":{"x":0,"y":3},"conditions":{"states":{"wait-for-ssm-execution-completed":"OK"}},"description":"Run custom JavaScript code.","predecessors":["wait-for-ssm-execution-completed"]},"wait-for-ssm-execution-completed":{"name":"wait-for-ssm-execution-completed","input":{"workflowId":"20661ec0-29d5-471f-9973-29679d5fe908","workflowInput":"{\n\"AutomationExecutionId\":\"{{result(\"systems_manager_start_automation_execution_1\").AutomationExecutionId }}\",\n\"awsregion\": \"{{input()[\"awsregion\"] }}\",\n\"dynatraceawsconnection\": \"{{ input()[\"dynatraceawsconnection\"] }}\"\n}"},"retry":{"count":99,"delay":120,"failedLoopIterationsOnly":true},"action":"dynatrace.automations:run-workflow","timeout":604800,"position":{"x":0,"y":2},"conditions":{"states":{"systems_manager_start_automation_execution_1":"OK"}},"description":"Modularize your workflows, run any existing workflow.","waitBefore":60,"predecessors":["systems_manager_start_automation_execution_1"]},"systems_manager_start_automation_execution_1":{"name":"systems_manager_start_automation_execution_1","input":{"region":"{{ input()[\"awsregion\"] }}","Parameters":"{ \n  \"stackname\": [\"{{input()[\"cf_stackname\"] }}\"]\n}","connection":"{% set awsconnection = input()[\"dynatraceawsconnection\"] %}\n{{ connection('builtin:hyperscaler-authentication.connections.aws', awsconnection) }}","DocumentName":"Dynwf-DeleteCloudFormationStack"},"retry":{"count":5,"delay":60,"failedLoopIterationsOnly":true},"action":"dynatrace.aws.connector:ssm-start-automation-execution","active":true,"timeout":604800,"position":{"x":0,"y":1},"description":"Initiates execution of an Automation runbook","predecessors":[]}}}